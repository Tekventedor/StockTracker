{{ $type := .Get "type" }}
{{ $height := .Get "height" | default "400" }}
{{ $width := .Get "width" | default "100%" }}
{{ $widgets := site.Data.widgets }}

{{ if eq $type "market-overview" }}
<div class="tradingview-widget-container" style="height: {{ $height }}px; width: {{ $width }};">
    <div class="tradingview-widget-container__widget" style="height: 100%;"></div>
    <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-market-overview.js" async>
    {{ $widgets.marketOverview | jsonify | safeJS }}
    </script>
</div>
{{ else if eq $type "market-quotes" }}
<div class="tradingview-widget-container" style="height: {{ $height }}px; width: {{ $width }};">
    <div class="tradingview-widget-container__widget" style="height: 100%;"></div>
    <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-market-quotes.js" async>
    {{ $widgets.marketQuotes | jsonify | safeJS }}
    </script>
</div>
{{ end }}

<!-- Load TradingView widget script -->
<script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>

<!-- Load widget configuration -->
{{ partial "widget-config.html" . }}

<!-- Initialize widgets -->
<script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize Market Overview widget
        const marketOverviewContainer = document.querySelector('.market-overview-widget');
        if (marketOverviewContainer && window.widgetConfigs) {
            new TradingView.widget({
                ...window.widgetConfigs.marketOverview,
                container_id: marketOverviewContainer.id
            });
        }

        // Initialize Market Quotes widget
        const marketQuotesContainer = document.querySelector('.market-quotes-widget');
        if (marketQuotesContainer && window.widgetConfigs) {
            new TradingView.widget({
                ...window.widgetConfigs.marketQuotes,
                container_id: marketQuotesContainer.id
            });
        }
    });
</script> 